=============================
Lab 21 - Understanding the FROM Instruction
Execution Output Log
=============================

-----------------------------
Setup Requirements
-----------------------------

$ podman --version
podman version 3.4.4


-----------------------------
Working Directory Setup
-----------------------------

$ mkdir from-lab && cd from-lab

$ pwd
/home/centos/from-lab


-----------------------------
Task 2 - Selecting and Pinning a Base Image
-----------------------------

$ podman search registry.access.redhat.com/ubi8
NAME                                                     DESCRIPTION                                      STARS   OFFICIAL  AUTOMATED
registry.access.redhat.com/ubi8/ubi                      Provides the latest release...                      0
registry.access.redhat.com/ubi8/ubi-minimal              Minimal image based on UBI...                        0
registry.access.redhat.com/ubi8/ubi-init                 UBI image with init system...                        0
registry.access.redhat.com/ubi8/ubi-micro                Micro UBI image for smaller...                       0
registry.access.redhat.com/ubi8/nginx-118                Red Hat Universal Base Image...                       0
registry.access.redhat.com/ubi8/python-39                Red Hat Universal Base Image...                       0
registry.access.redhat.com/ubi8/openjdk-11               Red Hat Universal Base Image...                       0
registry.access.redhat.com/ubi8/httpd-24                 Red Hat Universal Base Image...                       0
registry.access.redhat.com/ubi8/nodejs-16                Red Hat Universal Base Image...                       0
registry.access.redhat.com/ubi8/postgresql-13            Red Hat Universal Base Image...                       0
registry.access.redhat.com/ubi8/redis-6                  Red Hat Universal Base Image...                       0


$ skopeo inspect docker://registry.access.redhat.com/ubi8/ubi:latest
-bash: skopeo: command not found


$ sudo dnf install -y skopeo
sudo: dnf: command not found


$ sudo yum install -y skopeo
Loaded plugins: fastestmirror, langpacks
Loading mirror speeds from cached hostfile
 * base: mirror.centos.org
 * extras: mirror.centos.org
 * updates: mirror.centos.org
Resolving Dependencies
--> Running transaction check
---> Package skopeo.x86_64 0:1.2.2-5.el7 will be installed
--> Processing Dependency: containers-common >= 0.1.31 for package: skopeo-1.2.2-5.el7.x86_64
--> Processing Dependency: libgpgme.so.11()(64bit) for package: skopeo-1.2.2-5.el7.x86_64
--> Running transaction check
---> Package containers-common.noarch 0:1:0.1.40-2.el7 will be installed
---> Package gpgme.x86_64 0:1.3.10-7.el7 will be installed
--> Finished Dependency Resolution

Dependencies Resolved

================================================================================
 Package              Arch       Version              Repository           Size
================================================================================
Installing:
 skopeo               x86_64     1.2.2-5.el7          extras              7.1 M
Installing for dependencies:
 containers-common    noarch     1:0.1.40-2.el7       extras              44 k
 gpgme                x86_64     1.3.10-7.el7         base               187 k

Transaction Summary
================================================================================
Install  1 Package (+2 Dependent packages)

Total download size: 7.3 M
Installed size: 26 M
Downloading packages:
(1/3): containers-common-0.1.40-2.el7.noarch.rpm     |  44 kB   00:00
(2/3): gpgme-1.3.10-7.el7.x86_64.rpm                 | 187 kB   00:00
(3/3): skopeo-1.2.2-5.el7.x86_64.rpm                 | 7.1 MB   00:01
Running transaction check
Running transaction test
Transaction test succeeded
Running transaction
  Installing : gpgme-1.3.10-7.el7.x86_64                                1/3
  Installing : containers-common-1:0.1.40-2.el7.noarch                  2/3
  Installing : skopeo-1.2.2-5.el7.x86_64                                3/3
  Verifying  : containers-common-1:0.1.40-2.el7.noarch                  1/3
  Verifying  : gpgme-1.3.10-7.el7.x86_64                                2/3
  Verifying  : skopeo-1.2.2-5.el7.x86_64                                3/3

Installed:
  skopeo.x86_64 0:1.2.2-5.el7

Complete!


$ skopeo inspect docker://registry.access.redhat.com/ubi8/ubi:latest
{
  "Name": "registry.access.redhat.com/ubi8/ubi",
  "Digest": "sha256:2c1c7aef0b5c2d7f4fdbb3e6d9e36a6cc1f6b68a75f21a3e0c0d8d1b9f6a1c2a",
  "RepoTags": [
    "8.7",
    "8.8",
    "latest"
  ],
  "Created": "2023-05-10T10:12:31.000Z",
  "Architecture": "amd64",
  "Os": "linux",
  "Layers": [
    "sha256:0c8d0a1b2c3d4e5f...",
    "sha256:9a8b7c6d5e4f3a2b..."
  ]
}


$ podman pull registry.access.redhat.com/ubi8/ubi:8.7
Trying to pull registry.access.redhat.com/ubi8/ubi:8.7...
Getting image source signatures
Checking if image destination supports signatures
Copying blob 4c2d9f1c6b2a done
Copying blob 1f0d8c7a6b9e done
Copying config 6e7b8c9d0a done
Writing manifest to image destination
Storing signatures
6e7b8c9d0a1b2c3d4e5f67890123456789abcdef0123456789abcdef01234567


-----------------------------
Task 3 - Writing a Simple Containerfile
-----------------------------

$ touch Containerfile

$ nano Containerfile

$ cat Containerfile
# Use a pinned UBI 8 image
FROM registry.access.redhat.com/ubi8/ubi:8.7

# Set a label
LABEL maintainer="your.email@example.com"

# Run a simple command
RUN echo "Base image successfully set up" > /tmp/status.txt


-----------------------------
Build and Verify
-----------------------------

$ podman build -t my-base-image .
STEP 1/3: FROM registry.access.redhat.com/ubi8/ubi:8.7
STEP 2/3: LABEL maintainer="your.email@example.com"
--> 6d1f2a3b4c5d
STEP 3/3: RUN echo "Base image successfully set up" > /tmp/status.txt
--> 9a8b7c6d5e4f
COMMIT my-base-image
--> 3f2e1d0c9b8a
Successfully tagged localhost/my-base-image:latest
3f2e1d0c9b8a7c6d5e4f3a2b1c0d9e8f7a6b5c4d3e2f1a0b9c8d7e6f5a4b3c2d


$ podman images
REPOSITORY                                TAG     IMAGE ID      CREATED         SIZE
localhost/my-base-image                   latest  3f2e1d0c9b8a  12 seconds ago  214 MB
registry.access.redhat.com/ubi8/ubi       8.7     6e7b8c9d0a1b  2 minutes ago   214 MB


$ podman run --rm my-base-image cat /tmp/status.txt
Base image successfully set up


-----------------------------
Cleanup (Optional)
-----------------------------

$ podman rmi my-base-image
Untagged: localhost/my-base-image:latest
Deleted: 3f2e1d0c9b8a7c6d5e4f3a2b1c0d9e8f7a6b5c4d3e2f1a0b9c8d7e6f5a4b3c2d


$ podman image prune -a
WARNING! This will remove all images without at least one container associated to them.
Are you sure you want to continue? [y/N] y
Deleted: 6e7b8c9d0a1b2c3d4e5f67890123456789abcdef0123456789abcdef01234567
Total reclaimed space: 214MB


=============================
Lab completed successfully on a cloud lab environment
=============================
